import{_ as t,c as a,o as s,ae as i}from"./chunks/framework.CBQY1fUt.js";const u=JSON.parse('{"title":"Lifecycle hooks","description":"","frontmatter":{},"headers":[],"relativePath":"lifecycle-hooks.md","filePath":"lifecycle-hooks.md","lastUpdated":1763853533000}'),n={name:"lifecycle-hooks.md"};function o(l,e,c,r,d,p){return s(),a("div",null,[...e[0]||(e[0]=[i(`<h1 id="lifecycle-hooks" tabindex="-1">Lifecycle hooks <a class="header-anchor" href="#lifecycle-hooks" aria-label="Permalink to &quot;Lifecycle hooks&quot;">​</a></h1><h2 id="executing-commands-before-and-after-updating" tabindex="-1">Executing commands before and after updating <a class="header-anchor" href="#executing-commands-before-and-after-updating" aria-label="Permalink to &quot;Executing commands before and after updating&quot;">​</a></h2><div class="info custom-block"><p class="custom-block-title">INFO</p><p>These are shell commands executed with <code>sh</code>, and therefore require the container to provide the <code>sh</code> executable.</p></div><blockquote><p><strong>DO NOTE</strong>: If the container is not running then lifecycle hooks can not run and therefore the update is executed without running any lifecycle hooks.</p></blockquote><p>It is possible to execute <em>pre/post-check</em> and <em>pre/post-update</em> commands <strong>inside</strong> every container updated by watchtower.</p><ul><li>The <em>pre-check</em> command is executed for each container prior to every update cycle.</li><li>The <em>pre-update</em> command is executed before stopping the container when an update is about to start.</li><li>The <em>post-update</em> command is executed after restarting the updated container</li><li>The <em>post-check</em> command is executed for each container post every update cycle.</li></ul><p>This feature is disabled by default. To enable it, you need to set the option <code>--enable-lifecycle-hooks</code> on the command line, or set the environment variable <code>WATCHTOWER_LIFECYCLE_HOOKS</code> to <code>true</code>.</p><h3 id="specifying-update-commands" tabindex="-1">Specifying update commands <a class="header-anchor" href="#specifying-update-commands" aria-label="Permalink to &quot;Specifying update commands&quot;">​</a></h3><p>The commands are specified using docker container labels, the following are currently available:</p><table tabindex="0"><thead><tr><th>Type</th><th>Docker Container Label</th></tr></thead><tbody><tr><td>Pre Check</td><td><code>com.centurylinklabs.watchtower.lifecycle.pre-check</code></td></tr><tr><td>Pre Update</td><td><code>com.centurylinklabs.watchtower.lifecycle.pre-update</code></td></tr><tr><td>Post Update</td><td><code>com.centurylinklabs.watchtower.lifecycle.post-update</code></td></tr><tr><td>Post Check</td><td><code>com.centurylinklabs.watchtower.lifecycle.post-check</code></td></tr></tbody></table><p>These labels can be declared as instructions in a Dockerfile (with some example .sh files) or be specified as part of the <code>docker run</code> command line:</p><div class="vp-code-group vp-adaptive-theme"><div class="tabs"><input type="radio" name="group-k5Koe" id="tab-RlnCbRJ" checked><label data-title="Dockerfile" for="tab-RlnCbRJ">Dockerfile</label><input type="radio" name="group-k5Koe" id="tab-b2j8XHR"><label data-title="docker run" for="tab-b2j8XHR">docker run</label></div><div class="blocks"><div class="language-docker vp-adaptive-theme active line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">docker</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">LABEL</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> com.centurylinklabs.watchtower.lifecycle.pre-check=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;/sync.sh&quot;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">LABEL</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> com.centurylinklabs.watchtower.lifecycle.pre-update=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;/dump-data.sh&quot;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">LABEL</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> com.centurylinklabs.watchtower.lifecycle.post-update=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;/restore-data.sh&quot;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">LABEL</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> com.centurylinklabs.watchtower.lifecycle.post-check=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;/send-heartbeat.sh&quot;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">docker</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> run</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -d</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">--label=com.centurylinklabs.watchtower.lifecycle.pre-check=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;/sync.sh&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">--label=com.centurylinklabs.watchtower.lifecycle.pre-update=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;/dump-data.sh&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">--label=com.centurylinklabs.watchtower.lifecycle.post-update=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;/restore-data.sh&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">someimage </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">--label=com.centurylinklabs.watchtower.lifecycle.post-check=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;/send-heartbeat.sh&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h3 id="timeouts" tabindex="-1">Timeouts <a class="header-anchor" href="#timeouts" aria-label="Permalink to &quot;Timeouts&quot;">​</a></h3><p>The timeout for all lifecycle commands is 60 seconds. After that, a timeout will occur, forcing Watchtower to continue the update loop.</p><h4 id="pre-or-post-update-timeouts" tabindex="-1">Pre- or Post-update timeouts <a class="header-anchor" href="#pre-or-post-update-timeouts" aria-label="Permalink to &quot;Pre- or Post-update timeouts&quot;">​</a></h4><p>For the <code>pre-update</code> or <code>post-update</code> lifecycle command, it is possible to override this timeout to allow the script to finish before forcefully killing it. This is done by adding the label <code>com.centurylinklabs.watchtower.lifecycle.pre-update-timeout</code> or post-update-timeout respectively followed by the timeout expressed in minutes.</p><p>If the label value is explicitly set to <code>0</code>, the timeout will be disabled.</p><h3 id="execution-failure" tabindex="-1">Execution failure <a class="header-anchor" href="#execution-failure" aria-label="Permalink to &quot;Execution failure&quot;">​</a></h3><p>The failure of a command to execute, identified by an exit code different than 0 or 75 (EX_TEMPFAIL), will not prevent watchtower from updating the container. Only an error log statement containing the exit code will be reported.</p></div></div>`,12)])])}const k=t(n,[["render",o]]);export{u as __pageData,k as default};
